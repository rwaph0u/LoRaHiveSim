const STRINGS = {
  en: {
    appTitle: "LoRaHiveSim",
    Language: "Language",
    palette: "Palette",
    addHive: "+ Hive",
    addObstacle: "+ Obstacle",
    focusServer: "Focus server",
    measure: "Measure distance",
    measureHint: "Click two nodes/points on the canvas to measure. ESC to cancel.",
    obstacleContext: "Obstacle (context)",
    obstacleContextHint: "No obstacle selected â†’ these settings will be used when adding a new obstacle.",
    radiusDefault: "Radius (default)",
    lossDefault: "Loss (default)",
    radiusSelected: "Radius (selected)",
    lossSelected: "Loss (selected)",
    deleteSelection: "Delete selection",
    resetAll: "Reset all",
    copyShareLink: "Copy share link",
    loadFromUrl: "Load from URL",
    panZoomHint: "Space/Right/Middle = pan â€¢ Wheel = zoom",
    loraParams: "LoRa Parameters (global)",
    loraHint: "These parameters adjust range and sensitivity. Visual wave radius follows realistic range when enabled.",
    mpp: "Meters / pixel",
    realistic: "Realistic path-loss",
    freqMHz: "Freq (MHz)",
    txDbm: "TX power (dBm)",
    selection: "Selection",
    noSelection: "â€” Click a hive or obstacle on the canvas to select â€”",
    type: "Type",
    typeHive: "Hive",
    txPower: "TX Power (visual)",
    txHint: "This visual TX scales wave alpha; dBm is used when Realistic mode is ON.",
    stats: "Stats",
    resetStats: "Reset stats",
    logs: "Logs",
    debug: "Debug",
    state: "State",
    importExport: "ðŸ“¦ Import / Export",
    exportFile: "Export JSON (file)",
    exportToZone: "Export â†’ area",
    copyExport: "Copy export",
    importFile: "Import JSON (file)",
    importHint: "Tolerant import: unknown properties ignored, invalid values corrected.",
    exportAreaTitle: "Export Area (read-only)",
    importAreaTitle: "Import Area (paste JSON)",
    importFromArea: "Import from area",
    clear: "Clear",
    minimapTitle: "Mini-map (click/drag to navigate)",
    hintOverlay: "Space / right / middle click: pan â€” Wheel: zoom",
    geoTitle: "ðŸŒ Geo Import (experimental)",
    originLat: "Origin lat",
    originLon: "Origin lon",
    metersPerPx: "Meters per pixel",
    geoOptimize: "Optimize large files",
    geoTolerance: "Simplify tolerance (m)",
    geoProcessing: "Processing GeoJSON...",
    geoHint: "Paste GeoJSON (Polygons/Points). Large files will be processed asynchronously with automatic simplification. Points become hives or server if name='server'. Polygons auto-detect materials from OSM tags.",
    loadGeo: "Load GeoJSON",
  },
  fr: {
    appTitle: "LoRaHiveSim",
    Language: "Langue",
    palette: "Palette",
    addHive: "+ Rucher",
    addObstacle: "+ Obstacle",
    focusServer: "Focus serveur",
    measure: "Mesurer une distance",
    measureHint: "Clique deux nÅ“uds/points sur le canvas pour mesurer. Ã‰chap pour annuler.",
    obstacleContext: "Obstacle (contexte)",
    obstacleContextHint: "Aucun obstacle sÃ©lectionnÃ© â†’ ces rÃ©glages seront utilisÃ©s lors de lâ€™ajout dâ€™un nouvel obstacle.",
    radiusDefault: "Rayon (dÃ©faut)",
    lossDefault: "Perte (dÃ©faut)",
    radiusSelected: "Rayon (sÃ©lection)",
    lossSelected: "Perte (sÃ©lection)",
    deleteSelection: "Supprimer la sÃ©lection",
    resetAll: "Reset total",
    copyShareLink: "Copier lien de partage",
    loadFromUrl: "Charger depuis lâ€™URL",
    panZoomHint: "Espace/Droit/Milieu = pan â€¢ Molette = zoom",
    loraParams: "ParamÃ¨tres LoRa (globaux)",
    loraHint: "Ces paramÃ¨tres ajustent la portÃ©e et la sensibilitÃ©. Le rayon visuel suit la portÃ©e rÃ©aliste si activÃ©.",
    mpp: "MÃ¨tres / pixel",
    realistic: "ModÃ¨le rÃ©aliste de perte",
    freqMHz: "FrÃ©quence (MHz)",
    txDbm: "Puissance TX (dBm)",
    selection: "SÃ©lection",
    noSelection: "â€” Cliquez un rucher ou un obstacle sur le canvas pour sÃ©lectionner â€”",
    type: "Type",
    typeHive: "Rucher",
    txPower: "Puissance visuelle",
    txHint: "Cette puissance agit sur l'alpha visuel; le dBm est utilisÃ© si le mode rÃ©aliste est activÃ©.",
    stats: "Stats",
    resetStats: "Reset stats",
    logs: "Logs",
    debug: "Debug",
    state: "Ã‰tat",
    importExport: "ðŸ“¦ Import / Export",
    exportFile: "Exporter JSON (fichier)",
    exportToZone: "Exporter â†’ zone",
    copyExport: "Copier export",
    importFile: "Importer JSON (fichier)",
    importHint: "Import tolÃ©rant : propriÃ©tÃ©s inconnues ignorÃ©es, valeurs invalides corrigÃ©es.",
    exportAreaTitle: "Zone Export (lecture seule)",
    importAreaTitle: "Zone Import (coller JSON)",
    importFromArea: "Importer depuis zone",
    clear: "Vider",
    minimapTitle: "Mini-map (clic/drag pour naviguer)",
    hintOverlay: "Espace / clic droit / clic milieu : pan â€” Molette : zoom",
    geoTitle: "ðŸŒ Import Geo (expÃ©rimental)",
    originLat: "Latitude origine",
    originLon: "Longitude origine",
    metersPerPx: "MÃ¨tres par pixel",
    geoHint: "Colle un GeoJSON simple (Polygones/Points). Les points deviennent ruchers (ou serveur si name='server'). Les polygones deviennent des obstacles avec 'loss' [0..0.95].",
    loadGeo: "Charger GeoJSON",
    geoOptimize: "Optimiser gÃ©omÃ©tries",
    geoTolerance: "TolÃ©rance simplification",
    geoProcessing: "Traitement en cours...",
  }
};
function detectDefaultLang(){
  const nav = navigator.language || navigator.userLanguage || "en";
  return nav.toLowerCase().startsWith("fr") ? "fr" : "en";
}
function applyI18n(lang){
  const dict = STRINGS[lang] || STRINGS.en;
  document.querySelectorAll("[data-i18n]").forEach(el => {
    const key = el.getAttribute("data-i18n");
    if (dict[key]) el.textContent = dict[key];
  });
  document.getElementById("appTitle").childNodes[0].textContent = dict.appTitle + " ";
}
